"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function e(e,t,i,a){return new(i||(i=Promise))((function(o,l){function r(e){try{s(a.next(e))}catch(e){l(e)}}function n(e){try{s(a.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,n)}s((a=a.apply(e,t||[])).next())}))}(function(){return e(this,void 0,void 0,(function*(){yield figma.loadFontAsync({family:"Roboto",style:"Regular"})}))})().then(()=>{let e=figma.currentPage,t=figma.currentPage.children,i=figma.currentPage.selection;function a(e,t){figma.clientStorage.setAsync(e,JSON.stringify(t)).catch(e=>{console.log("error setting data")})}function o(t,i,a,o,l,r,n,s,c,g,d,f,h,m,p,u){const y=a;let R,S,E,L,b;if(!0===t){R=figma.createFrame(),S=figma.createFrame(),E=figma.createText(),L=figma.createText();let e,t,a,o,l,r,n=375,s=375;R.name=i,R.resize(n,s),R.layoutMode="VERTICAL",R.topRightRadius=16,R.topLeftRadius=16,R.bottomLeftRadius=16,R.bottomRightRadius=16,R.setRelaunchData({edit:"Press to launch Figchat and add your comments"}),R.y=m,R.x=p,S.layoutMode="VERTICAL",S.resize(n,s),S.name="holder",S.horizontalPadding=16,S.verticalPadding=16,S.itemSpacing=10,S.fills=[],E.name="Title",E.characters="Chat for # "+h,E.textAlignHorizontal="CENTER",E.textAlignVertical="CENTER",E.resize(375,100),E.fontSize=16,L.name="Footer",L.characters="Chat by selecting this frame and running Figchat",L.textAlignHorizontal="CENTER",L.textAlignVertical="CENTER",L.resize(375,100),L.fontSize=11,L.fills=[{type:"SOLID",color:{r:85/255,g:101/255,b:117/255}}],!0===u&&(R.fills=[{type:"SOLID",color:{r:29/255,g:43/255,b:54/255}}],L.fills=[{type:"SOLID",color:{r:165/255,g:178/255,b:189/255}}],E.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),b=figma.createFrame(),e=figma.createFrame(),t=figma.createFrame(),a=figma.createText(),o=figma.createText(),l=figma.createText(),r=figma.createText(),b.visible=!1,b.layoutMode="HORIZONTAL",b.layoutAlign="STRETCH",b.verticalPadding=16,b.itemSpacing=10,b.fills=[],b.name="voter",b.fills=[],e.strokeWeight=2,e.strokes=[{type:"SOLID",color:{r:197/255,g:206/255,b:214/255}}],e.topRightRadius=50,e.topLeftRadius=50,e.bottomLeftRadius=50,e.bottomRightRadius=50,e.name="positive",e.layoutAlign="CENTER",e.layoutMode="HORIZONTAL",e.verticalPadding=14,e.horizontalPadding=20,e.itemSpacing=6,e.resizeWithoutConstraints(60,52),e.fills=[],t.strokes=[{type:"SOLID",color:{r:197/255,g:206/255,b:214/255}}],t.topRightRadius=50,t.topLeftRadius=50,t.bottomLeftRadius=50,t.bottomRightRadius=50,t.name="negative",t.layoutAlign="CENTER",t.layoutMode="HORIZONTAL",t.verticalPadding=14,t.horizontalPadding=20,t.itemSpacing=6,t.strokeWeight=2,t.resizeWithoutConstraints(60,52),t.fills=[],a.characters="👍",a.fontSize=16,a.layoutAlign="CENTER",o.characters="👎",o.fontSize=16,o.layoutAlign="CENTER",l.characters="0",l.fontSize=16,l.fills=[{type:"SOLID",color:{r:147/255,g:161/255,b:176/255}}],l.name="count-pos",l.layoutAlign="CENTER",r.characters="0",r.fontSize=16,r.fills=[{type:"SOLID",color:{r:147/255,g:161/255,b:176/255}}],r.name="count-neg",r.layoutAlign="CENTER",t.appendChild(o),t.appendChild(r),e.appendChild(a),e.appendChild(l),b.appendChild(e),b.appendChild(t)}o=figma.createFrame(),l=figma.createFrame(),r=figma.createText(),n=figma.createText(),o.layoutMode="VERTICAL",o.layoutAlign="STRETCH",o.name="line item",o.itemSpacing=4,o.fills=[],l.topRightRadius=24,l.topLeftRadius=24,l.bottomLeftRadius=24,l.bottomRightRadius=10,l.name="bubble",l.layoutAlign="MAX",r.characters=y,r.x=16,r.y=16,r.fontSize=13,r.lineHeight={unit:"PIXELS",value:18},r.name="Text",r.constraints={horizontal:"STRETCH",vertical:"STRETCH"},r.resize(r.width+2,r.height),r.textAutoResize="HEIGHT",n.characters=s,n.fills=[{type:"SOLID",color:{r:147/255,g:161/255,b:176/255}}],n.layoutAlign="MAX";let I=r.height+32,A=r.width+32;l.resize(A,I),!1===d&&("blue"===c&&(l.fills=[{type:"SOLID",color:{r:18/255,g:146/255,b:238/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"yellow"===c&&(l.fills=[{type:"SOLID",color:{r:1,g:197/255,b:85/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}]),"orange"===c&&(l.fills=[{type:"SOLID",color:{r:1,g:145/255,b:57/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"red"===c&&(l.fills=[{type:"SOLID",color:{r:242/255,g:52/255,b:89/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"indigo"===c&&(l.fills=[{type:"SOLID",color:{r:59/255,g:100/255,b:210/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"green"===c&&(l.fills=[{type:"SOLID",color:{r:57/255,g:172/255,b:110/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"purple"===c&&(l.fills=[{type:"SOLID",color:{r:98/255,g:105/255,b:197/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"lavender"===c&&(l.fills=[{type:"SOLID",color:{r:217/255,g:220/255,b:253/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}]),"whaletail"===c&&(l.fills=[{type:"SOLID",color:{r:114/255,g:150/255,b:225/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"lime"===c&&(l.fills=[{type:"SOLID",color:{r:194/255,g:240/255,b:215/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}])),!0===d&&(l.fills=[{type:"SOLID",color:{r:41/255,g:67/255,b:81/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],l.topRightRadius=24,l.topLeftRadius=24,l.bottomLeftRadius=10,l.bottomRightRadius=24,l.layoutAlign="MIN",n.layoutAlign="MIN",n.characters=s+" 👑"),!0===f&&function(e,t,i,a,o){e.appendChild(t),t.appendChild(i),t.appendChild(a),i.appendChild(o);let l=o,r=i;o.height,l.width>315&&(r.layoutAlign="STRETCH",r.layoutMode="VERTICAL",r.horizontalPadding=16,r.verticalPadding=16,l.textAutoResize="NONE",l.resize(315,l.height),l.textAutoResize="HEIGHT")}(g,o,l,n,r),!1===f&&function(t,i,a,o,l,r,n,s,c){e.appendChild(t),t.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(c),i.appendChild(a),a.appendChild(o),a.appendChild(l),o.appendChild(r);let g=r,d=o;g.width>315?(d.layoutAlign="STRETCH",d.layoutMode="VERTICAL",d.horizontalPadding=16,d.verticalPadding=16,g.textAutoResize="NONE",g.resize(315,g.height),g.textAutoResize="HEIGHT"):g.resize(g.width+2,g.height)}(R,S,o,l,n,r,E,b,L),figma.notify("chat added!")}if(0===i.length)figma.closePlugin("⚠️ Please select a frame to comment on ⚠️");else{let e;figma.showUI(__html__,{width:380,height:255}),new Promise((e,t)=>{figma.clientStorage.getAsync("commentator").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({commentator:i})}).catch(e=>{t(e)})}),new Promise((e,t)=>{figma.clientStorage.getAsync("color").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({color:i})}).catch(e=>{t(e)})}),new Promise((e,t)=>{figma.clientStorage.getAsync("name").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({name:i})}).catch(e=>{t(e)})});let l,r=0,n=0,s=0;i.forEach(t=>{"FRAME"===t.type&&(r=t.x,n=t.y,l=t.width,e=t.name,figma.ui.postMessage({getfile:e}));let i=[];if("FRAME"===t.type){i.push(t.name),JSON.stringify(i),-1!==i.join().indexOf("figchat__")&&(s=1,figma.ui.postMessage({newframe:!1}))}});let c,g=r+l+50,d="figchat__"+e;t.forEach(e=>{e.name===d&&(c="found",figma.ui.postMessage({newframe:!1}))}),figma.ui.onmessage=l=>{if("add-vote"===l.type&&console.log(l.name+": voted "+l.vote),"add-message"===l.type){if("found"===c&&t.forEach(t=>{"FRAME"===t.type&&t.name===d&&t.children.forEach(t=>{if("FRAME"===t.type&&"holder"===t.name){let i,a,r,s;o(!1,d,l.message,i,a,r,s,l.name,l.color,t,l.switch,!0,e,n,g,l.dark)}})}),s>=1&&i.forEach(t=>{"FRAME"===t.type&&t.children.forEach(t=>{if("FRAME"===t.type&&"holder"===t.name){let i,a,r,s;o(!1,d,l.message,i,a,r,s,l.name,l.color,t,l.switch,!0,e,n,g,l.dark)}"FRAME"===t.type&&"voter"===t.name&&t.children.forEach(e=>{e.name,l.name})})}),void 0===c&&0===s){let t,i,a,r,s;o(!0,d,l.message,t,i,a,r,l.name,l.color,s,l.switch,!1,e,n,g,l.dark),figma.closePlugin()}a("color",l.color),a("name",l.name),a("commentator",l.switch)}}}});

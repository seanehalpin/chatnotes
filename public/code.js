"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function e(e,t,i,o){return new(i||(i=Promise))((function(a,l){function r(e){try{c(o.next(e))}catch(e){l(e)}}function n(e){try{c(o.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,n)}c((o=o.apply(e,t||[])).next())}))}(function(){return e(this,void 0,void 0,(function*(){yield figma.loadFontAsync({family:"Roboto",style:"Regular"})}))})().then(()=>{let e=figma.currentPage,t=figma.currentPage.children,i=figma.currentPage.selection;function o(e,t){figma.clientStorage.setAsync(e,JSON.stringify(t)).catch(e=>{console.log("error setting data")})}function a(t,i,o,a,l,r,n,c,s,g,f,d,h,m,p,u){const y=o;let R,S,b,I;if(!0===t){R=figma.createFrame(),S=figma.createFrame(),b=figma.createText(),I=figma.createText();let e=375,t=375;R.name=i,R.resize(e,t),R.layoutMode="VERTICAL",R.topRightRadius=16,R.topLeftRadius=16,R.bottomLeftRadius=16,R.bottomRightRadius=16,R.setRelaunchData({edit:"Press to launch Figchat and add your comments"}),R.y=m,R.x=p,S.layoutMode="VERTICAL",S.resize(e,t),S.name="holder",S.horizontalPadding=16,S.verticalPadding=16,S.itemSpacing=10,S.fills=[],b.name="Title",b.characters="Chat for # "+h,b.textAlignHorizontal="CENTER",b.textAlignVertical="CENTER",b.resize(375,100),b.fontSize=16,I.name="Footer",I.characters="Chat by selecting this frame and running Figchat",I.textAlignHorizontal="CENTER",I.textAlignVertical="CENTER",I.resize(375,100),I.fontSize=11,I.fills=[{type:"SOLID",color:{r:85/255,g:101/255,b:117/255}}],!0===u&&(R.fills=[{type:"SOLID",color:{r:29/255,g:43/255,b:54/255}}],I.fills=[{type:"SOLID",color:{r:165/255,g:178/255,b:189/255}}],b.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}])}a=figma.createFrame(),l=figma.createFrame(),r=figma.createText(),n=figma.createText(),a.layoutMode="VERTICAL",a.layoutAlign="STRETCH",a.name="line item",a.itemSpacing=4,a.fills=[],l.topRightRadius=24,l.topLeftRadius=24,l.bottomLeftRadius=24,l.bottomRightRadius=10,l.name="bubble",l.layoutAlign="MAX",r.characters=y,r.x=16,r.y=16,r.fontSize=13,r.name="Text",r.constraints={horizontal:"STRETCH",vertical:"STRETCH"},r.resize(r.width+2,r.height),r.textAutoResize="HEIGHT",n.characters=c,n.fills=[{type:"SOLID",color:{r:147/255,g:161/255,b:176/255}}],n.layoutAlign="MAX";let L=r.height+32,E=r.width+32;l.resize(E,L),!1===f&&("blue"===s&&(l.fills=[{type:"SOLID",color:{r:18/255,g:146/255,b:238/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"yellow"===s&&(l.fills=[{type:"SOLID",color:{r:1,g:197/255,b:85/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}]),"orange"===s&&(l.fills=[{type:"SOLID",color:{r:1,g:145/255,b:57/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"red"===s&&(l.fills=[{type:"SOLID",color:{r:242/255,g:52/255,b:89/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"indigo"===s&&(l.fills=[{type:"SOLID",color:{r:59/255,g:100/255,b:210/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"green"===s&&(l.fills=[{type:"SOLID",color:{r:57/255,g:172/255,b:110/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"purple"===s&&(l.fills=[{type:"SOLID",color:{r:98/255,g:105/255,b:197/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"lavender"===s&&(l.fills=[{type:"SOLID",color:{r:217/255,g:220/255,b:253/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}]),"whaletail"===s&&(l.fills=[{type:"SOLID",color:{r:114/255,g:150/255,b:225/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}]),"lime"===s&&(l.fills=[{type:"SOLID",color:{r:194/255,g:240/255,b:215/255}}],r.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}])),!0===f&&(l.fills=[{type:"SOLID",color:{r:41/255,g:67/255,b:81/255}}],r.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],l.topRightRadius=24,l.topLeftRadius=24,l.bottomLeftRadius=10,l.bottomRightRadius=24,l.layoutAlign="MIN",n.layoutAlign="MIN",n.characters=c+" 👑"),!0===d&&function(e,t,i,o,a){e.appendChild(t),t.appendChild(i),t.appendChild(o),i.appendChild(a);let l=a,r=i;a.height,l.width>315&&(r.layoutAlign="STRETCH",r.layoutMode="VERTICAL",r.horizontalPadding=16,r.verticalPadding=16,l.textAutoResize="NONE",l.resize(315,l.height),l.textAutoResize="HEIGHT")}(g,a,l,n,r),!1===d&&function(t,i,o,a,l,r,n,c){e.appendChild(t),t.appendChild(n),t.appendChild(i),t.appendChild(c),i.appendChild(o),o.appendChild(a),o.appendChild(l),a.appendChild(r);let s=r,g=a;s.width>315?(g.layoutAlign="STRETCH",g.layoutMode="VERTICAL",g.horizontalPadding=16,g.verticalPadding=16,s.textAutoResize="NONE",s.resize(315,s.height),s.textAutoResize="HEIGHT"):s.resize(s.width+2,s.height)}(R,S,a,l,n,r,b,I),figma.notify("chat added!")}if(0===i.length)figma.closePlugin("⚠️ Please select a frame to comment on ⚠️");else{let e;figma.showUI(__html__,{width:380,height:255}),new Promise((e,t)=>{figma.clientStorage.getAsync("commentator").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({commentator:i})}).catch(e=>{t(e)})}),new Promise((e,t)=>{figma.clientStorage.getAsync("color").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({color:i})}).catch(e=>{t(e)})}),new Promise((e,t)=>{figma.clientStorage.getAsync("name").then(t=>{let i=t?JSON.parse(t):[];e(i),figma.ui.postMessage({name:i})}).catch(e=>{t(e)})});let l,r=0,n=0,c=0;i.forEach(t=>{"FRAME"===t.type&&(r=t.x,n=t.y,l=t.width,e=t.name,figma.ui.postMessage({getfile:e}));let i=[];if("FRAME"===t.type){i.push(t.name),JSON.stringify(i),-1!==i.join().indexOf("figchat__")&&(c=1,figma.ui.postMessage({newframe:!1}))}});let s,g=r+l+50,f="figchat__"+e;t.forEach(e=>{e.name===f&&(s="found",figma.ui.postMessage({newframe:!1}))}),figma.ui.onmessage=l=>{if("add-message"===l.type){if("found"===s&&t.forEach(t=>{"FRAME"===t.type&&t.name===f&&t.children.forEach(t=>{if("FRAME"===t.type&&"holder"===t.name){let i,o,r,c;a(!1,f,l.message,i,o,r,c,l.name,l.color,t,l.switch,!0,e,n,g,l.dark)}})}),c>=1&&i.forEach(t=>{"FRAME"===t.type&&t.children.forEach(t=>{if("FRAME"===t.type&&"holder"===t.name){let i,o,r,c;a(!1,f,l.message,i,o,r,c,l.name,l.color,t,l.switch,!0,e,n,g,l.dark)}})}),void 0===s&&0===c){let t,i,o,r,c;a(!0,f,l.message,t,i,o,r,l.name,l.color,c,l.switch,!1,e,n,g,l.dark),figma.closePlugin()}o("color",l.color),o("name",l.name),o("commentator",l.switch)}}}});
